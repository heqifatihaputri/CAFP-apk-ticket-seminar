<%= render 'layouts/shared/breadcrumb' %>
<%= form_tag make_order_temp_user_carts_path, method: :get do %>
  <section class="section checkout">
    <div class="row">
      <div class="col-xl-7">
        <div class="card">
          <div class="card-body pt-3">
            <div class="tab-content pt-2">
              <div class="tab-pane fade show active checkout-overview" id="checkout-overview">
                <h5 class="card-title" style="font-size: 24px!important;">Order Summary</h5>
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th scope="col">Ticket</th>
                      <th scope="col">QTY</th>
                      <th scope="col">Item Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @cart_items.each do |item| %>
                      <%= hidden_field_tag "checkout[cart_item_ids][]", item.id, class: "cart" %>
                      <tr>
                        <th>
                          <span style="font-weight: bold;color: #4154f1;"><%= event_name(item) %></span>
                          <p><small><%= ticket_name(item) %></small></p>
                        </th>
                        <th><%= item.quantity %></th>
                        <th><%= money_format(item.ticket_stock.price * item.quantity) %></th>
                      </tr>
                    <% end %>
                    <tr>
                      <th>Total</th>
                      <th></th>
                      <th>
                        <strong><%= money_format(@total) %></strong>
                      </th>
                    </tr>
                    <% if @current_mutation > 0 && @current_mutation < @total %>
                      <% grand_total = @total %>
                      <tr class="order_use-balance" data-grand-total-bef="<%= grand_total.to_f %>" data-current-mutation="<%= @current_mutation.to_f %>">
                        <th>e-Wallet used</th><th></th>
                        <th class="text-right text-dark"><strong>- <%= money_format(@current_mutation) %></strong></td>
                      </tr>
                      <% grand_total -= @current_mutation %>
                      <tr>
                        <th colspan="3">
                          <span style="font-weight: 400; color: red;">
                            You need <b><%= money_format(grand_total) %> </b> additional balance in your e-Wallet to process this transaction
                          </span>
                        </th>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-5">
        <div class="card">
          <div class="card-body pt-3">
            <div class="tab-content pt-2">
              <div class="tab-pane fade show active checkout-overview" id="checkout-overview">
                <h5 class="card-title" style="font-size: 24px!important;">Billing Details</h5>
                <% unless @total > 0 %>
                  <span style="color: red;"><b>FREE</b></span>
                  <%= hidden_field_tag :payment_check, 'free' %>
                <% else %>
                  <div>
                    <fieldset class="row mb-3">
                      <legend class="col-form-label col-sm-2 pt-0">
                        <%= image_tag "e-wallet.jpg", style: "width: 50px; height: 50px; margin-left: 25px;" %>
                      </legend>
                      <div class="col-sm-10">
                        <div class="form-check">
                          <%= radio_button_tag :payment_check, "e_wallet", true, class: "form-check-input", id: "e_wallet", required: true %>
                          <%= label_tag :payment_check, "Your e-Wallet", class: "form-check-label", for: "e_wallet" %>
                          <p><small><strong><%= money_format(@current_mutation) %></strong></small></p>
                        </div>
                      </div>
                    </fieldset>
                  </div>
                <% end %>
                <% insufficient_balance = @total > 0 && @current_mutation < @total ? "disabled" : "" %>
                <button type="submit" class="btn btn-primary align-self-end w-100 mt-5" <%= insufficient_balance %>
                  data-confirm="Are you sure want to process the payment?">Place Order</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
<% end %>
